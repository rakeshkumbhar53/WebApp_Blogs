<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Blog</title>
     
	 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
    <style>
        #context-menu {
            background-color: white;
            border: 1px solid #ccc;
            z-index: 1000;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            display: none;
            position: absolute;
        }
        .dropdown-item {
            padding: 8px 12px;
            cursor: pointer;
        }
        .dropdown-item:hover {
            background-color: #f0f0f0;
        }
        #editor {
            border: 1px solid #ced4da;
            padding: 10px;
            border-radius: 0.25rem;
            min-height: 200px;
            position: relative;
        }
        .draggable-image {
            max-width: 100%;
            margin: 10px 0;
        }
        .image-resizer {
            width: 10px;
            height: 10px;
            background: red;
            position: absolute;
            right: 0;
            bottom: 0;
            cursor: se-resize;
            z-index: 10;
            display: none; /* Hide initially */
        }
        .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            text-align: center;
            line-height: 20px;
            cursor: pointer;
            font-size: 16px;
            z-index: 15;
            display: none; /* Hide initially */
        }
        .remove-btn:hover {
            background: rgba(255, 0, 0, 1);
        }
    </style>
</head>
<body>
    <header class="text-white text-center py-1" style="background-color: #495057 !important;">
        <h1>---</h1>
        <nav>
            <a class="text-white mx-3" href="#">Home</a>
            <a class="text-white mx-3" href="#">About</a>
            <a class="text-white mx-3" href="#">Blog</a>
            <a class="text-white mx-3" href="#">Contact</a>
        </nav>
    </header>

    <main class="container mt-5">
        <section id="blog-area">
            <h2>Latest Blogs</h2>
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">Post Title 1</h5>
                    <h6 class="card-subtitle mb-2 text-muted">Author Name | Publication Date</h6>
                    <p class="card-text">Short description of the blog post...</p>
                    <a href="#" class="card-link">Read More</a>
                </div>
            </div>
            <!-- Add more posts here -->
        </section>

        <section id="add-blog" class="mt-5">
            <h2>Add a New Blog Post</h2>
            <form>
                <div class="form-group">
                    <label for="post-title">Post Title:</label>
                    <input type="text" class="form-control" id="post-title" required>
                </div>

                <div class="form-group">
                    <div class="d-flex">
					<label for="post-content">Post Content:</label>
                    <div class="ms-auto float-right mb-1 mt-2">
                        <button type="button" class="p-0 px-2 btn btn-primary" title="Bold" onclick="formatText('bold')"><b>B</b></button>
                        <button type="button" class="p-0 px-2 btn btn-primary" title="Italic" onclick="formatText('italic')"><em>I</em></button>
                        <button type="button" class="p-0 px-2 btn btn-primary" title="Underline" onclick="formatText('underline')"><u>U</u></button>
						<button type="button" class="p-0 px-2 btn btn-primary" id="toolbar-img-upload">Image Upload</button>
                    </div>
					</div>
					
					<div id="editor" contenteditable="true" class="border p-2" ondragover="event.preventDefault()" 
                         ondrop="dropImage(event)"></div>
                </div>

                <div class="form-group" hidden>
                     
                    <input type="file" class="form-control-file" id="image-upload" accept="image/*">
                </div>

                <button id="submit" class="btn btn-success mt-3">Submit Post</button>
            </form>
        </section>

        <div id="context-menu" class="dropdown-menu">
           
            <a class="dropdown-item" id="upload-image-option">Upload Image</a>
        </div>
    </main>

    <footer class="bg-light text-center py-4 mt-5">
        <p><a href="#">Privacy Policy</a> | <a href="#">Terms of Service</a></p>
        <div class="social-media">
            <a href="#" class="mx-2">Facebook</a>
            <a href="#" class="mx-2">Twitter</a>
            <a href="#" class="mx-2">Instagram</a>
        </div>
    </footer>
	
	 
     
	<div class="toast-container position-fixed top-0 end-0 p-3">
			<div id="myToast" class="toast" role="alert" style="position: relative;" aria-live="assertive" aria-atomic="true">
				<button type="button" class="btn-close position-absolute top-0 end-0 me-1 mt-1" data-bs-dismiss="toast" aria-label="Close"></button>  
				<div class="toast-body" id="toastMsg">
					
				</div>
			</div>
		</div>
	 

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
 
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
	function formatText(command) {
    document.execCommand(command, false, null);
     }

        const editor = document.getElementById('editor');
        const contextMenu = document.getElementById('context-menu');

        // Show custom context menu on right-click
        editor.addEventListener('contextmenu', function(event) {
            event.preventDefault();
            contextMenu.style.left = `${event.pageX}px`;
            contextMenu.style.top = `${event.pageY}px`;
            contextMenu.style.display = 'block';
        });

        // Hide the context menu when clicking elsewhere
        document.addEventListener('click', function() {
            contextMenu.style.display = 'none';
        });

          // Handle Upload Image Toolbar
        document.getElementById('toolbar-img-upload').addEventListener('click', function() {
            document.getElementById('image-upload').click();
        });

        // Handle Upload Image right click
        document.getElementById('upload-image-option').addEventListener('click', function() {
            document.getElementById('image-upload').click();
        });
		
		

        // Handle image upload
        document.getElementById('image-upload').addEventListener('change', function(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const imgContainer = createImageContainer(e.target.result);
                editor.appendChild(imgContainer);
            };
            
            if (file) {
                reader.readAsDataURL(file);
            }
        });

        // Function to create an image container
        function createImageContainer(src) {
            const imgContainer = document.createElement('div');
            imgContainer.style.position = 'relative';
            imgContainer.style.display = 'inline-block';

            const img = document.createElement('img');
            img.src = src;
            img.className = 'draggable-image';
            img.style.maxWidth = '100%';

            const resizer = document.createElement('div');
            resizer.className = 'image-resizer';
            imgContainer.appendChild(img);
            imgContainer.appendChild(resizer);

            const removeBtn = document.createElement('div');
            removeBtn.className = 'remove-btn';
            removeBtn.textContent = 'X';
            imgContainer.appendChild(removeBtn);

            // Add event listeners
            addImageClickHandler(imgContainer, removeBtn, resizer);
            makeImageDraggable(imgContainer);
            makeImageResizable(resizer, img);

            return imgContainer;
        }

        function addImageClickHandler(imgContainer, removeBtn, resizer) {
            imgContainer.addEventListener('mouseenter', () => {
                removeBtn.style.display = 'block'; // Show remove button
                resizer.style.display = 'block'; // Show resizer
            });
            imgContainer.addEventListener('mouseleave', () => {
                removeBtn.style.display = 'none'; // Hide remove button
                resizer.style.display = 'none'; // Hide resizer
            });

            removeBtn.addEventListener('click', () => {
                imgContainer.remove(); // Remove image on button click
            });
        }

        function makeImageDraggable(imageContainer) {
            let isDragging = false;
            let startX, startY, origX, origY;

            imageContainer.addEventListener('mousedown', (e) => {
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                origX = imageContainer.offsetLeft;
                origY = imageContainer.offsetTop;
                document.body.style.cursor = 'move'; // Change cursor
                e.preventDefault(); // Prevent default behavior
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
                document.body.style.cursor = 'default'; // Reset cursor
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const editorRect = editor.getBoundingClientRect();
                    const dx = e.clientX - startX;
                    const dy = e.clientY - startY;

                    // Calculate new position
                    const newLeft = origX + dx;
                    const newTop = origY + dy;

                    // Boundary checks
                    if (newLeft >= 0 && newLeft + imageContainer.offsetWidth <= editorRect.width) {
                        imageContainer.style.left = `${newLeft}px`;
                    }
                    if (newTop >= 0 && newTop + imageContainer.offsetHeight <= editorRect.height) {
                        imageContainer.style.top = `${newTop}px`;
                    }
                    imageContainer.style.position = 'absolute'; // Set absolute position for dragging
                }
            });
        }

        function makeImageResizable(resizer, image) {
            let isResizing = false;
            let startX, startY;

            resizer.addEventListener('mousedown', (e) => {
                isResizing = true;
                startX = e.clientX;
                startY = e.clientY;
                document.body.style.cursor = 'se-resize'; // Change cursor
                e.stopPropagation(); // Prevent triggering the drag event
            });

            document.addEventListener('mouseup', () => {
                isResizing = false;
                document.body.style.cursor = 'default'; // Reset cursor
            });

            document.addEventListener('mousemove', (e) => {
                if (isResizing) {
                    const newWidth = image.clientWidth + (e.clientX - startX);
                    const newHeight = image.clientHeight + (e.clientY - startY);
                    image.style.width = `${newWidth}px`;
                    image.style.height = `${newHeight}px`;
                    startX = e.clientX;
                    startY = e.clientY;
                }
            });
        }

        document.getElementById('submit').addEventListener('click', function (event) {
            event.preventDefault();
            var PostTitle = document.getElementById("post-title").value;
            var editorContent = document.getElementById('editor').innerHTML;

            if (PostTitle === "") {
                alert("Please Enter Post Title");
                return false;
            }
            if (editorContent === "") {
                alert("Please Enter Post Content");
                return false;
            }

            editorContent = btoa(editorContent);
            const dataToSend = { post_title: PostTitle, post_content: editorContent };
            $.ajax({
                url: 'write_data.php',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(dataToSend),
                success: function (response) {
				     showToast({msg:"Post Added Successfully!!",className:"bg-success text-white",addonStyle:""})
                     
                },
                error: function (xhr, status, error) {
				    showToast({msg:'Error: '+ status +" , "+ error,className:"bg-danger text-white",addonStyle:""})
                     
                }
            });
        });
		
		
	function showToast(msgBody)
    {
      document.getElementById('toastMsg').innerHTML=msgBody.msg;
      var myToast = document.getElementById('myToast')
      
      if(msgBody.addonStyle)
        myToast.setAttribute("style","position: relative;"+msgBody.addonStyle);
        
      myToast.setAttribute("class","toast "+msgBody.className);
      var toast = new bootstrap.Toast(myToast);
   
        toast.show();
 
        // Automatically hide the toast after 5 seconds
        setTimeout(function () {
            toast.hide();
        }, 5000);
    }
    </script>
</body>
</html>
